<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Game API" />
    <meta name="msapplication-TileColor" content="#6200ee" />
    <meta name="theme-color" content="#6200ee" />
    <link rel="manifest" href="./webmanifest.json" />
    <link
      rel="icon"
      type="image/png"
      href="./assets/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg" />
    <link rel="shortcut icon" href="./assets/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./assets/apple-touch-icon.png"
    />
    <meta name="apple-mobile-web-app-title" content="Game API" />
    <title>Home</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="./styles.css" />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script defer src="./init.js"></script>
    <script type="module">
      import { fetchGames } from './api.js';

      document.addEventListener('DOMContentLoaded', async function () {
        const gamesList = document.getElementById('games-list');
        if (gamesList) {
          try {
            const games = await fetchGames();

            if (Array.isArray(games) && games.length > 0) {
              gamesList.innerHTML = games
                .map(
                  (game) => `
              <div class="mb-4 p-4 rounded shadow bg-white">
                <h2 class="text-lg font-bold">${game.name || 'No Name'}</h2>
                <p>ID: ${game.id || 'N/A'}</p>
                <p>${game.description || ''}</p>
                <img src="https://ryanstronks.gc-webhosting.nl/api/storage/${game.image_path.replace(
                  /\\/g,
                  ''
                )}" alt="${game.name}" style="max-width:150px;"/>
              </div>
            `
                )
                .join('');
            } else {
              gamesList.textContent = 'No games found.';
            }
          } catch (err) {
            gamesList.textContent = 'Failed to load games.';
            console.error(err);
          }
        }

        const dialogEl = document.getElementById('search-dialog');
        const searchDialog = new mdc.dialog.MDCDialog(dialogEl);

        const searchTextField = new mdc.textField.MDCTextField(
          document.querySelector('.mdc-text-field')
        );

        const searchBtn = document.getElementById('search-button');
        searchBtn.addEventListener('click', function () {
          searchDialog.open();
          setTimeout(() => {
            document.getElementById('search-input').focus();
          }, 200);
        });

        const drawerEl = document.getElementById('app-drawer');
        const drawer = new mdc.drawer.MDCDrawer(drawerEl);
        const menuBtn = document.querySelector(
          '.mdc-top-app-bar__navigation-icon'
        );
        const listEl = drawerEl.querySelector('.mdc-list');
        const mainContentEl = document.querySelector('.main-content');

        menuBtn.addEventListener('click', () => {
          drawer.open = true;
        });

        listEl.addEventListener('click', (event) => {
          drawer.open = false;
        });

        drawerEl.addEventListener('MDCDrawer:closed', () => {
          const focusable = mainContentEl.querySelector(
            'input, button, [tabindex]:not([tabindex="-1"])'
          );
          if (focusable) focusable.focus();
          else mainContentEl.focus();
        });
      });
    </script>
  </head>

  <body>
    <header class="mdc-top-app-bar">
      <div class="mdc-top-app-bar__row">
        <section
          class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"
        >
          <button
            class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button"
            aria-label="Open navigation menu"
          >
            menu
          </button>
          <p class="mdc-top-app-bar__title">Game API</p>
        </section>
        <section
          class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end"
          role="toolbar"
        >
          <button
            class="material-icons mdc-top-app-bar__action-item mdc-icon-button"
            aria-label="Search"
            id="search-button"
            type="button"
          >
            search
          </button>
          <div class="mdc-dialog" id="search-dialog">
            <div class="mdc-dialog__container">
              <div
                class="mdc-dialog__surface"
                role="alertdialog"
                aria-modal="true"
                aria-labelledby="search-dialog-title"
                aria-describedby="search-dialog-content"
              >
                <div class="mdc-dialog__content" id="search-dialog-content">
                  <div style="width: 100%; padding: 8px 0">
                    <label
                      class="mdc-text-field mdc-text-field--filled"
                      style="width: 100%"
                    >
                      <span class="mdc-text-field__ripple"></span>
                      <span class="mdc-floating-label" id="search-label"
                        >Searchâ€¦</span
                      >
                      <input
                        class="mdc-text-field__input"
                        type="text"
                        id="search-input"
                        aria-labelledby="search-label"
                        autocomplete="off"
                      />
                      <span class="mdc-line-ripple"></span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="mdc-dialog__scrim"></div>
          </div>
        </section>
      </div>
    </header>

    <aside class="mdc-drawer mdc-drawer--modal" id="app-drawer">
      <div class="mdc-drawer__content">
        <nav class="mdc-list">
          <div class="flex item-center justify-center !pt-2 !pb-4">
            <img src="./assets/Game API.svg" alt="Image missing." />
          </div>
          <a
            class="mdc-list-item mdc-list-item--activated hover:bg-gray-200"
            href="#"
            aria-current="page"
            tabindex="0"
          >
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true"
              >inbox
            </i>
            <span class="mdc-list-item__text">Temp</span>
          </a>
          <a
            class="mdc-list-item mdc-list-item--activated !mt-2 hover:bg-gray-200"
            href="#"
            aria-current="page"
            tabindex="0"
          >
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true"
              >inbox
            </i>
            <span class="mdc-list-item__text">Temp</span>
          </a>
          <a
            class="mdc-list-item mdc-list-item--activated !mt-2 hover:bg-gray-200"
            href="#"
            aria-current="page"
            tabindex="0"
          >
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true"
              >inbox
            </i>
            <span class="mdc-list-item__text">Temp</span>
          </a>
        </nav>
      </div>
    </aside>
    <div class="mdc-drawer-scrim"></div>

    <main class="main-content" tabindex="0">
      <div id="games-list" class="p-4"></div>
    </main>
  </body>
</html>
