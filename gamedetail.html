<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Game Detail</title>
    <link rel="stylesheet" href="./styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script type="module">
      import { fetchGame, getGameImageUrl, deleteGame } from './api.js';

      function getIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
      }

      async function loadGameDetail() {
        const id = getIdFromUrl();
        const container = document.getElementById('game-detail');
        if (!id) {
          container.innerHTML =
            '<div class="p-8 text-red-400">No game ID provided.</div>';
          return;
        }
        container.innerHTML =
          '<div class="p-8 text-center text-zinc-300">Loading...</div>';
        try {
          const game = await fetchGame(id);
          container.innerHTML = `
      <div class="max-w-2xl mx-auto bg-gradient-to-bl from-white/30 via-white/10 to-purple-200/20 backdrop-blur-md shadow-lg rounded-3xl p-8 mt-10">
        <a href="index.html" class="text-purple-400 hover:underline flex items-center mb-6">
          <span class="material-icons mr-2">arrow_back</span>
          <span>Terug naar overzicht</span>
        </a>
        <div class="flex flex-col md:flex-row items-center gap-8">
          ${
            game.image_path
              ? `<img src="${getGameImageUrl(game.image_path)}" alt="${
                  game.name
                }" class="w-48 h-48 object-cover rounded-xl shadow mb-4 md:mb-0" />`
              : ''
          }
          <div class="flex-1 text-center md:text-left">
            <h1 class="text-3xl font-bold mb-2 text-purple-900 dark:text-purple-200">${
              game.name
            }</h1>
            <p class="mb-4 text-zinc-700 dark:text-zinc-300">${
              game.description
            }</p>
            <button id="delete-btn" class="mt-6 px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 transition">
              <span class="material-icons align-middle mr-1" style="font-size: 20px;">delete</span>
              Delete Game
            </button>
          </div>
        </div>
      </div>
      <div
        id="delete-modal"
        class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden"
      >
        <div class="bg-[#1e293b] !p-6 rounded-3xl text-center w-full max-w-md">
          <h2 class="text-xl font-bold !mb-4 text-blue-200">Are you sure?</h2>
          <p class="!mb-6 text-zinc-300">
            Do you really want to delete
            <span class="font-semibold">${game.name}</span>?
          </p>
          <div class="flex justify-center gap-4">
            <button
              id="confirm-delete"
              class="!px-4 !py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition"
            >
              Yes, Delete
            </button>
            <button
              id="cancel-delete"
              class="!px-4 !py-2 rounded bg-zinc-500 text-white hover:bg-zinc-600 cursor-pointer"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    `;

          // Modal logic
          const deleteBtn = document.getElementById('delete-btn');
          const modal = document.getElementById('delete-modal');
          const cancelBtn = document.getElementById('cancel-delete');
          const confirmBtn = document.getElementById('confirm-delete');

          deleteBtn.onclick = () => modal.classList.remove('hidden');
          cancelBtn.onclick = () => modal.classList.add('hidden');
          confirmBtn.onclick = async () => {
            try {
              await deleteGame(game.id);
              window.location.href = 'index.html';
            } catch {
              modal.classList.add('hidden');
              alert('Failed to delete game.');
            }
          };
        } catch (err) {
          container.innerHTML = `<div class="p-8 text-red-400">Failed to load game details.</div>`;
        }
      }

      document.addEventListener('DOMContentLoaded', loadGameDetail);
    </script>
  </head>
  <body
    class="bg-gradient-to-b from-white to-purple-100 dark:from-black dark:to-[#923CB5] min-h-screen"
  >
    <div id="game-detail"></div>
  </body>
</html>
